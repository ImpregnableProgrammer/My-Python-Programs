# Challenge: https://codegolf.stackexchange.com/questions/154872/panfix-to-parenthesized-infix

# SUBMISSION -- 226 bytes
from re import*
P='([*+]+)'+r'(\(.+?\)|_)\1'*2;R=lambda i,J=lambda i,o:i[:o]+sub(P,lambda o:'('+o[2]+o[1]+o[3]+')',i[o:],1),s=search:s(P,i)and R([J(i,o)for o in range(len(i))if s(P,J(i,o))or J(i,o)[0]+J(i,o)[-1]=='()'][0])or i

# TEST CASES
for i in [('+*+_*+_*+++_+*+_*+_*+++',
           '((_*+_)+(_+(_*+_)))'),
          ('**++*+***++_+_++_+*++*+***_*++*+*****_**_*_***',
           '((((_+_)+_)*++*+***_)*(_*(_*_)))'),
          ('***_**_***_*',
           '((_**_)*_)'),
          ('+_+_+',
           '(_+_)'),
          ('*+*+++**+***+++++_*+*+++**+***+++++_*+*+++**+***+++++',
           '(_*+*+++**+***+++++_)'),
          ('*++++*+*_*_*+*+++****+_++****+_++****++*+*+++_*+++',
           '(((_*_)+*+(_++****+_))*+++_)'),
          ('+**+_*+_*+*_*+*_*+*_+*_+**+',
           '(((_*+_)*_)+(_*(_+*_)))'),
          ('+**+++++_+++++_+++++*_*+*+_++++++_+++++_+++++++*',
           '(((_+++++_)*_)+*(_+(_+++++_)))'),
          ('+*+*+_+*+_+*+*_*+*_*+*+_+*+_+*+*+',
           '(((_+*+_)*_)+(_*(_+*+_)))'),
          ('**_**_**_*_****_*',
           '((_*(_*(_*_)))*_)')]:
    
    print('OUTPUT: '+R(i[0]))
    assert R(i[0])==i[1],'CASE '+i[0]+' FAILED'

print('ALL TEST CASES PASSED')
